<!doctype html><html lang=zh>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Golang 開發環境 - 使用 neovim - amikai's blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content><meta name=description content="此篇設定部分已經過時，請看此篇 Golang 開發環境 - 使用 neovim 0.5 你確定要用 neovim 開發 golang? 現在是 vscode 稱霸天下的時代，理所當然的 (neo)vim 也常常被拿來 vscode 比較，vscode 內建"><meta name=keywords content="go 語言 neovim 環境設定,kubernetes,golang,k8s,neovim">
<meta name=generator content="Hugo 0.87.0 with theme even">
<link rel=canonical href=https://amikai.github.io/2020/09/03/go_neovim_env/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css rel=stylesheet>
<link href=/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet>
<meta property="og:title" content="Golang 開發環境 - 使用 neovim">
<meta property="og:description" content="此篇設定部分已經過時，請看此篇 Golang 開發環境 - 使用 neovim 0.5 你確定要用 neovim 開發 golang? 現在是 vscode 稱霸天下的時代，理所當然的 (neo)vim 也常常被拿來 vscode 比較，vscode 內建">
<meta property="og:type" content="article">
<meta property="og:url" content="https://amikai.github.io/2020/09/03/go_neovim_env/"><meta property="og:image" content="https://amikai.github.io/2020/09/03/go_neovim_env/cover.png"><meta property="article:section" content="post">
<meta property="article:published_time" content="2020-09-03T10:48:54+00:00">
<meta property="article:modified_time" content="2020-09-03T10:48:54+00:00">
<meta itemprop=name content="Golang 開發環境 - 使用 neovim">
<meta itemprop=description content="此篇設定部分已經過時，請看此篇 Golang 開發環境 - 使用 neovim 0.5 你確定要用 neovim 開發 golang? 現在是 vscode 稱霸天下的時代，理所當然的 (neo)vim 也常常被拿來 vscode 比較，vscode 內建"><meta itemprop=datePublished content="2020-09-03T10:48:54+00:00">
<meta itemprop=dateModified content="2020-09-03T10:48:54+00:00">
<meta itemprop=wordCount content="2370"><meta itemprop=image content="https://amikai.github.io/2020/09/03/go_neovim_env/cover.png">
<meta itemprop=keywords content="vim,neovim,"><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://amikai.github.io/2020/09/03/go_neovim_env/cover.png">
<meta name=twitter:title content="Golang 開發環境 - 使用 neovim">
<meta name=twitter:description content="此篇設定部分已經過時，請看此篇 Golang 開發環境 - 使用 neovim 0.5 你確定要用 neovim 開發 golang? 現在是 vscode 稱霸天下的時代，理所當然的 (neo)vim 也常常被拿來 vscode 比較，vscode 內建"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>amikai's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>amikai's blog</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>Golang 開發環境 - 使用 neovim</h1>
<div class=post-meta>
<span class=post-time> 2020-09-03 </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title></h2>
<div class="post-toc-content always-active">
<nav id=TableOfContents></nav>
</div>
</div>
<div class=post-content>
<blockquote>
<p>此篇設定部分已經過時，請看此篇 <a href=https://amikai.github.io/2021/08/16/go_neovim_env_0.5/>Golang 開發環境 - 使用 neovim 0.5</a></p>
</blockquote>
<p><img src=cover.png alt></p>
<h1 id=你確定要用-neovim-開發-golang>你確定要用 neovim 開發 golang?</h1>
<p>現在是 vscode 稱霸天下的時代，理所當然的 (neo)vim 也常常被拿來 vscode 比較，vscode 內建整合了 git、debugger、自動補全引擎、terminal、extension manager，另外 Golang 在 vscode 上的 extension 支援相當良好: 包括跳轉到定義 (go to definition)、重新命名 (rename)、跳轉到型態定義 (go to type definition)⋯⋯ 一堆細節功能，近期由於 google golang team 接手 go 語言的 vscode extension，相信使用 vscode 開發是不錯的選擇。</p>
<p>(neo)vim 當然也能達到 vscode 的類似功能，但是必須花時間設定調教，在 vscode 問世之前我會推薦 (Neo)vim 給我的朋友，vscode 問世之後我就開始推薦 vscode。</p>
<blockquote>
<p>本文給那些本來就在 (neo)vim 裡打滾的人，但對 go 語言設定不熟的人，
如果你是一張白紙，而且沒有被虐的癖好，我建議選擇 vscode，可以用較少的時間進入到寫程式的環節，而不是一直在花時間在設定，這篇文你也沒必要看下去。</p>
</blockquote>
<h1 id=預備動作>預備動作</h1>
<p>Must have</p>
<ul>
<li>你應該先安裝好 neovim nightly 版本，<code>brew install neovim --HEAD</code></li>
<li>你應該要知道怎麼使用 vim-plug，至少要知道 <code>:PlugInstall</code></li>
<li>你應該先把 go 語言環境安裝好</li>
</ul>
<p>Nice to have</p>
<ul>
<li>你知道 <code>:checkhealth</code> 和 <code>:UpdateRemotePlugin</code></li>
<li>你熟悉 <code>:help</code> 的使用方式，這裡有一篇好文：<a href=https://vim.fandom.com/wiki/Learn_to_use_help>Learn to use help</a></li>
</ul>
<h1 id=開發環境基本功能>開發環境基本功能</h1>
<p>一個好用的 Editor 我認為應該包含以下幾點基本功能:</p>
<ul>
<li>Auto completion - 好的自動補全引擎</li>
<li>File manager - 可以在側邊欄看到專案的結構</li>
<li>Real time linter - 在寫 code 犯錯的同時，有一些提示 (也就是 diagnostic 功能)</li>
<li>Background compile - 編譯的同時不應該卡住整個 Editor，要讓使用者能做其他事情</li>
<li>Code navigation: 包含跳轉到定義，跳轉到型態定義，或是當一個檔案寫得很長的時候，怎麼綜觀全局</li>
</ul>
<p>以下我將會介紹我使用的 Plugin，達到我上述所提到的功能。
以下使用的皆是 Neovim nightly 版本，使用 stable 是沒有官方 LSP 支援的。</p>
<p>Note：neovim 是由 vim 所 fork 出來的，差異介紹請看<a href=https://kerol2r20.github.io/post/2017-10-29-neovim-introdunction/>這篇</a>，某些 Plugin 不會同時相容於兩者，我接會標明。</p>
<h1 id=file-explorer-defxnvim>File explorer (defx.nvim)</h1>
<p><img src=defx.png alt></p>
<p>為什麼不用老牌的 nerdtree 就好，要使用別的 file explorer，
沒辦法 nerdtree 就是慢，只要專案稍微有一點規模，就會有明顯的卡頓。</p>
<p>defx 由 python3 寫成，是一個需要高度手動設定的 file explorer，不像 nerdtree 幾乎可以開箱及用，在設定時一定得查看 defx 的 help 文件，裡頭有相當多設定範例。</p>
<p>為了讓 neovim 知道 python3 在哪，將此行寫入 vimrc：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=k>let</span> <span class=nx>g</span>:<span class=nx>python3_host_prog</span> <span class=p>=</span> <span class=s1>&#39;/path/to/python3&#39;</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>設定完此行之行 執行 <code>:checkhealth</code>，neovim 就會開始查看有沒有抓到 python3</p>
<p>安裝</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>Plug</span> <span class=s1>&#39;Shougo/defx.nvim&#39;</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>安裝完後執行 <code>:UpdateRemotePlugins</code></p>
<p>使用 F4 映射到 defx</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>noremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>F4</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>cmd</span><span class=p>&gt;</span><span class=nx>Defx</span> <span class=p>-</span><span class=nx>buffer</span><span class=p>-</span><span class=nx>name</span><span class=p>=</span><span class=s2>&#34;defx&#34;</span><span class=p>&lt;</span><span class=nx>cr</span><span class=p>&gt;</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>外觀設定</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>call</span> <span class=nx>defx</span>#<span class=nx>custom</span>#<span class=nx>column</span><span class=p>(</span><span class=s1>&#39;icon&#39;</span><span class=p>,</span> {<span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;directory_icon&#39;</span>: <span class=s1>&#39;▸&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;opened_icon&#39;</span>: <span class=s1>&#39;▾&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;root_icon&#39;</span>: <span class=s1>&#39;📁 &#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ }<span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nx>call</span> <span class=nx>defx</span>#<span class=nx>custom</span>#<span class=nx>column</span><span class=p>(</span><span class=s1>&#39;filename&#39;</span><span class=p>,</span> {<span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;min_width&#39;</span>: <span class=m>128</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;max_width&#39;</span>: <span class=m>128</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ }<span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nx>call</span> <span class=nx>defx</span>#<span class=nx>custom</span>#<span class=nx>option</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>,</span> {<span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;columns&#39;</span>: <span class=s1>&#39;mark:indent:icon:filename:type&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;split&#39;</span>: <span class=s1>&#39;vertical&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;winwidth&#39;</span>: <span class=m>35</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;direction&#39;</span>: <span class=s1>&#39;topleft&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;resume&#39;</span>: <span class=nx>v</span>:<span class=nx>false</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;toggle&#39;</span>: <span class=nx>v</span>:<span class=nx>true</span><span class=err>
</span><span class=err></span>            \ }<span class=p>)</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>使用 enter 打開或關閉資料夾：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-VIM data-lang=VIM><span class=nx>nnoremap</span> <span class=p>&lt;</span><span class=nx>silent</span><span class=p>&gt;&lt;</span><span class=nx>buffer</span><span class=p>&gt;&lt;</span><span class=nx>expr</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>CR</span><span class=p>&gt;</span><span class=err>
</span><span class=err></span>            \ <span class=nx>defx</span>#<span class=nx>is_directory</span><span class=p>()</span> ?<span class=err>
</span><span class=err></span>            \ <span class=nx>defx</span>#<span class=nx>do_action</span><span class=p>(</span><span class=s1>&#39;open_or_close_tree&#39;</span><span class=p>)</span> :<span class=err>
</span><span class=err></span>            \ <span class=nx>defx</span>#<span class=nx>do_action</span><span class=p>(</span><span class=s1>&#39;drop&#39;</span><span class=p>)</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>因為 defx 的高度彈性，以及舊有的 nerdtree使用習慣，所以我就把 defx 的 key mapping 設定成類似 nerdtree，這裡就只做基本設定，以後有空會多開一篇詳細講 defx 設定，如果有興趣請參考<a href=https://github.com/amikai/nvimrc/blob/46d4c73f9e/config/defx.vim>我的設定</a></p>
<p>Note: defx (neovim only)</p>
<p>類似 Plugin: <a href=https://github.com/preservim/nerdtree>nerdtree</a> (vim and neovim), <a href=https://github.com/justinmk/vim-dirvish>vim-dirvish</a> (vim and neovim)</p>
<h1 id=auto-completion-completion-nvim--diagnostic-diagnostic-nvim>Auto completion (completion-nvim) & diagnostic (diagnostic-nvim)</h1>
<p>completion-nvim 和 diagnostic-nvim 都是基於 nvim-lspconfig 的 Plugin，
可以把 nvim-lspconfig 當成和 language server 溝通的基礎設施，Golang 預設的 language server 當然就是 gopls 啦</p>
<p>安裝</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>Plug</span> <span class=s1>&#39;neovim/nvim-lspconfig&#39;</span><span class=err>
</span><span class=err></span><span class=nx>Plug</span> <span class=s1>&#39;nvim-lua/diagnostic-nvim&#39;</span><span class=err>
</span><span class=err></span><span class=nx>Plug</span> <span class=s1>&#39;nvim-lua/completion-nvim&#39;</span><span class=err>
</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>在 lsp client 時，啟動 <code>completion-nvim</code> 和 <code>diagnostic-nvim</code>：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>lua</span> <span class=o>&lt;&lt;</span> <span class=n>EOF</span>
    <span class=kd>local</span> <span class=n>nvim_lsp</span> <span class=o>=</span> <span class=n>require</span><span class=s1>&#39;nvim_lsp&#39;</span>
    <span class=kd>local</span> <span class=n>on_attach_vim</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>bufnr</span><span class=p>)</span>
        <span class=n>require</span><span class=s1>&#39;completion&#39;</span><span class=p>.</span><span class=n>on_attach</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>bufnr</span><span class=p>)</span>
        <span class=n>require</span><span class=s1>&#39;diagnostic&#39;</span><span class=p>.</span><span class=n>on_attach</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=n>bufnr</span><span class=p>)</span>
    <span class=kr>end</span>
    <span class=n>nvim_lsp.gopls</span><span class=p>.</span><span class=n>setup</span><span class=p>{</span>
        <span class=n>on_attach</span><span class=o>=</span><span class=n>on_attach_vim</span>
    <span class=p>}</span>
<span class=n>EOF</span>
</code></pre></td></tr></table>
</div>
</div><p><code>diagnostic-nvim</code> 範例設定：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>call</span> <span class=nx>sign_define</span><span class=p>(</span><span class=s2>&#34;LspDiagnosticsErrorSign&#34;</span><span class=p>,</span> {<span class=s2>&#34;text&#34;</span> : <span class=s2>&#34;E&#34;</span><span class=p>,</span> <span class=s2>&#34;texthl&#34;</span> : <span class=s2>&#34;LspDiagnosticsError&#34;</span>}<span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>call</span> <span class=nx>sign_define</span><span class=p>(</span><span class=s2>&#34;LspDiagnosticsWarningSign&#34;</span><span class=p>,</span> {<span class=s2>&#34;text&#34;</span> : <span class=s2>&#34;W&#34;</span><span class=p>,</span> <span class=s2>&#34;texthl&#34;</span> : <span class=s2>&#34;LspDiagnosticsWarning&#34;</span>}<span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>call</span> <span class=nx>sign_define</span><span class=p>(</span><span class=s2>&#34;LspDiagnosticsInformationSign&#34;</span><span class=p>,</span> {<span class=s2>&#34;text&#34;</span> : <span class=s2>&#34;I&#34;</span><span class=p>,</span> <span class=s2>&#34;texthl&#34;</span> : <span class=s2>&#34;LspDiagnosticsInformation&#34;</span>}<span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>call</span> <span class=nx>sign_define</span><span class=p>(</span><span class=s2>&#34;LspDiagnosticsHintSign&#34;</span><span class=p>,</span> {<span class=s2>&#34;text&#34;</span> : <span class=s2>&#34;H&#34;</span><span class=p>,</span> <span class=s2>&#34;texthl&#34;</span> : <span class=s2>&#34;LspDiagnosticsHint&#34;</span>}<span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>diagnostic_show_sign</span> <span class=p>=</span> <span class=m>1</span><span class=err>
</span><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>diagnostic_enable_virtual_text</span> <span class=p>=</span> <span class=m>1</span><span class=err>
</span><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>diagnostic_insert_delay</span> <span class=p>=</span> <span class=m>0</span><span class=err>
</span><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>diagnostic_virtual_text_prefix</span> <span class=p>=</span> <span class=s1>&#39;&lt;&#39;</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>效果：
<img src=diagnostic_demo.gif alt></p>
<p>如果覺得字還沒打完就有警告很煩，可以改變此選項 <code>let g:diagnostic_insert_delay = 1</code>，則會在進入 normal mode 時進行警告。</p>
<p><code>completion-nvim</code> 範例設定：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=k>let</span> <span class=nx>g</span>:<span class=nx>completion_chain_complete_list</span> <span class=p>=</span> [<span class=err>
</span><span class=err></span>            \{<span class=s1>&#39;complete_items&#39;</span>: [<span class=s1>&#39;lsp&#39;</span>]}<span class=p>,</span><span class=err>
</span><span class=err></span>            \]<span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>效果
<img src=completion_demo.gif alt></p>
<p>Note: <code>nvim-lspconfig</code>, <code>completion-nvim</code>, <code>diagnostic-nvim</code> 皆不相容 vim</p>
<p>LSP 相關 Plugin： <a href=https://github.com/prabirshrestha/vim-lsp>vim-lsp</a> (vim only), <a href=https://github.com/autozimu/LanguageClient-neovim>LanguageClient-neovim</a> (neovim only)</p>
<p>Completion 相關 Plugin： <a href=https://github.com/ncm2/ncm2>ncm2</a> (vim8 and neovim), <a href=https://github.com/Shougo/deoplete.nvim>deoplete.nvim</a> (vim8 and neovim)</p>
<p>Diagnostic 相關 Plugin: <a href=https://github.com/neomake/neomake>neomake</a> (neovim and vim8), <a href=https://github.com/dense-analysis/ale>ale</a> (neovim and vim8)</p>
<blockquote>
<p>看了 completion-nvim 的 contribution 大部分是由 haorenW1025 大大所寫，帳號掛 NTU，台灣人寫的套件還不支持一波</p>
</blockquote>
<h1 id=code-outline-tagbar>Code Outline (tagbar)</h1>
<p><img src=tagbar_demo.png alt></p>
<p>當 code 越寫越多，一個 file 越長越大，一個 file 超過 1000 行，或超過 15 個 function，就需要一個綜觀全局的 Plugin，這當然就需要交給 <code>tagbar</code> 了。</p>
<p>另外一種情境，當你不熟你手上的這份專案時，用 <code>tagbar</code> 先進行大綱式的觀察，是再好不過的方式了</p>
<p>首先先安裝 <a href=https://github.com/jstemmer/gotags>gotags</a>, gotags 在 Readme 上都寫好怎麼設定了。</p>
<p>安裝 Tagbar:</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>Plug</span> <span class=s1>&#39;majutsushi/tagbar&#39;</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>gotags 及 tagbar 設定：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=k>let</span> <span class=nx>g</span>:<span class=nx>tagbar_type_go</span> <span class=p>=</span> {<span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;ctagstype&#39;</span> : <span class=s1>&#39;go&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;kinds&#39;</span>     : [<span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;p:package&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;i:imports:1&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;c:constants&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;v:variables&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;t:types&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;n:interfaces&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;w:fields&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;e:embedded&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;m:methods&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;r:constructor&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;f:functions&#39;</span><span class=err>
</span><span class=err></span>            \ ]<span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;sro&#39;</span> : <span class=s1>&#39;.&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;kind2scope&#39;</span> : {<span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;t&#39;</span> : <span class=s1>&#39;ctype&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;n&#39;</span> : <span class=s1>&#39;ntype&#39;</span><span class=err>
</span><span class=err></span>            \ }<span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;scope2kind&#39;</span> : {<span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;ctype&#39;</span> : <span class=s1>&#39;t&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;ntype&#39;</span> : <span class=s1>&#39;n&#39;</span><span class=err>
</span><span class=err></span>            \ }<span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;ctagsbin&#39;</span>  : <span class=s1>&#39;gotags&#39;</span><span class=p>,</span><span class=err>
</span><span class=err></span>            \ <span class=s1>&#39;ctagsargs&#39;</span> : <span class=s1>&#39;-sort -silent&#39;</span><span class=err>
</span><span class=err></span>            \ }<span class=err>
</span></code></pre></td></tr></table>
</div>
</div><h1 id=go-development-plugin-vim-go>Go development plugin (vim-go)</h1>
<p>Golang 在 vim 的開發中，不可能不提 <code>vim-go</code> 了，應該也是我在 vim plugin 看過支援完整的開發工具之一了，vim-go 設定眾多，我只挑出了我覺得最有用的幾個出來談。</p>
<p>安裝</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>Plug</span> <span class=s1>&#39;fatih/vim-go&#39;</span><span class=p>,</span>{<span class=s1>&#39;for&#39;</span>:<span class=s1>&#39;go&#39;</span><span class=p>,</span> <span class=s1>&#39;do&#39;</span>: <span class=s1>&#39;:GoUpdateBinaries&#39;</span>}<span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p><a href=https://github.com/golangci/golangci-lint>golangci-lint</a> 是把不一樣的 go 語言 linter 集合起來成一包，在 teminal 打 <code>golangci-lint linters</code> 就會列出一堆 linter，挑選自己想要的 linter 放入 <code>g:go_metalinter_enabled</code> 陣列裡。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=k>let</span> <span class=nx>g</span>:<span class=nx>go_metalinter_command</span> <span class=p>=</span> <span class=s2>&#34;golangci-lint&#34;</span><span class=err>
</span><span class=err></span><span class=k>let</span> <span class=nx>g</span>:<span class=nx>go_metalinter_enabled</span> <span class=p>=</span> [<span class=s1>&#39;vet&#39;</span><span class=p>,</span> <span class=s1>&#39;errcheck&#39;</span><span class=p>,</span> <span class=s1>&#39;staticcheck&#39;</span><span class=p>,</span> <span class=s1>&#39;gosimple&#39;</span>]<span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>使用 <code>:GoMetaLinter</code> 開始對專案進行檢查。</p>
<p>當然 code 越大或是 linter 放得越多檢查越慢，所以我通常寫到一個段落才下此命令，linter 檢查完後 quickfix list 則會跳出，請看demo：</p>
<p><img src=golangci_lint_demo.gif alt></p>
<p>code navigation 設定，不使用 <code>vim-go</code> 預設的 key mapping，使用自己習慣的方式：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=k>let</span> <span class=nx>g</span>:<span class=nx>go_def_mapping_enabled</span> <span class=p>=</span> <span class=m>0</span><span class=err>
</span><span class=err></span><span class=nx>autocmd</span> <span class=nx>Filetype</span> <span class=nx>go</span> <span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=nx>gd</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>go</span><span class=p>-</span><span class=nx>def</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>autocmd</span> <span class=nx>Filetype</span> <span class=nx>go</span> <span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=nx>gD</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>go</span><span class=p>-</span><span class=nx>describe</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>autocmd</span> <span class=nx>Filetype</span> <span class=nx>go</span> <span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=nx>gR</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>go</span><span class=p>-</span><span class=nx>rename</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>autocmd</span> <span class=nx>Filetype</span> <span class=nx>go</span> <span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=nx>gr</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>go</span><span class=p>-</span><span class=nx>referrers</span><span class=p>)</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>最屌的是 vim-go 能直接跑 Testing (<code>:GoTest</code>), Debugger (<code>:GoDebugStart</code>), Run (<code>:GoRun</code>), Build (<code>:GoBuild</code>)</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>autocmd</span> <span class=nx>Filetype</span> <span class=nx>go</span> <span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>f4</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>go</span><span class=p>-</span><span class=nx>test</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>autocmd</span> <span class=nx>Filetype</span> <span class=nx>go</span> <span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>f5</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>go</span><span class=p>-</span><span class=nx>build</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nx>autocmd</span> <span class=nx>Filetype</span> <span class=nx>go</span> <span class=nx>nmap</span> <span class=p>&lt;</span><span class=nx>buffer</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>f6</span><span class=p>&gt;</span> <span class=p>&lt;</span><span class=nx>Plug</span><span class=p>&gt;(</span><span class=nx>go</span><span class=p>-</span><span class=nx>run</span><span class=p>)</span><span class=err>
</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p><code>:GoTest</code> demo：
<img src=go_test_demo.gif alt></p>
<p>vim-go 設定一定要看過 <a href=https://github.com/fatih/vim-go-tutorial>vim-go-tutorial</a>，由 vim-go 作者提供的設定教學。</p>
<h1 id=結語>結語</h1>
<p>如果要一個適合自己的 (neo)vim 環境，當然這篇文章只是冰山一角而已。這裡提到的 Plugin，每一個都可以開一篇文章來介紹，所以每一個 Plugin 我盡量用最簡單的範例設定，展現它的功能和精髓。另外還有 fuzzy finder, auto pair, indent line guide, snippet ..等 Plugin, 還沒提到，之後會分好幾篇文章來寫。</p>
<p>在配置設定的一開始，盡量先去抄別人的，直接看看抄了設定會發生什麼效果， 或是使用 <code>:help</code> 查詢看看。</p>
<h1 id=q--a>Q & A</h1>
<p>要去哪裡查到別人的 vim 設定？
在 github 上查詢關鍵字：dotfile, dotfiles, vimrc, vim-config, nvimrc 等等的字。
這裡我就提供兩個大神的 vim 設定：</p>
<ul>
<li><a href=https://github.com/Shougo/shougo-s-github>https://github.com/Shougo/shougo-s-github</a></li>
<li><a href=https://github.com/rafi/vim-config>https://github.com/rafi/vim-config</a></li>
</ul>
<h1 id=reference>Reference</h1>
<ul>
<li><a href=https://github.com/neovim/nvim-lspconfig>https://github.com/neovim/nvim-lspconfig</a></li>
<li><a href=https://github.com/fatih/vim-go-tutorial>https://github.com/fatih/vim-go-tutorial</a></li>
</ul>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/vim/>vim</a>
<a href=/tags/neovim/>neovim</a>
</div>
<nav class=post-nav>
<a class=prev href=/2020/09/07/vim-mark-tips/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">聊聊 vim mark 使用情境 - code 參照</span>
<span class="prev-text nav-mobile"></span>
</a>
<a class=next href=/2020/07/07/golang78syntax2/>
<span class="next-text nav-default">Golang 78 語法篇 - method set</span>
<span class="next-text nav-mobile"></span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<script src=https://utteranc.es/client.js repo=amikai/my_hugo_blog_utterances issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://www.linkedin.com/in/yun-kai-chuang-122064a5/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/amikai class="iconfont icon-github" title=github></a>
<a href=https://amikai.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
%!(EXTRA string=<a class=hexo-link href=https://gohugo.io>Hugo</a>)
</span>
<span class=division>|</span>
<span class=theme-info>
-
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<span class=copyright-year>
&copy;
-
2021<span class=heart><i class="iconfont icon-heart"></i></span><span></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/lib/fancybox/jquery.fancybox-3.1.20.min.js></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-172478407-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</body>
</html>