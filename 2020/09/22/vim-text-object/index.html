<!doctype html><html lang=zh>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>你應該擴充的 text object - amikai's blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content><meta name=description content="vim 高效率編輯的背後，operator, motion, text object 的配合功不可沒。 operator 是編輯的動作， text object 就是文字區塊，motion 是跳轉到文件點，透過三者的按鍵配合"><meta name=keywords content="go 語言 neovim 環境設定,kubernetes,golang,k8s,neovim">
<meta name=generator content="Hugo 0.87.0 with theme even">
<link rel=canonical href=https://amikai.github.io/2020/09/22/vim-text-object/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css rel=stylesheet>
<link href=/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet>
<meta property="og:title" content="你應該擴充的 text object">
<meta property="og:description" content="vim 高效率編輯的背後，operator, motion, text object 的配合功不可沒。 operator 是編輯的動作， text object 就是文字區塊，motion 是跳轉到文件點，透過三者的按鍵配合">
<meta property="og:type" content="article">
<meta property="og:url" content="https://amikai.github.io/2020/09/22/vim-text-object/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2020-09-22T19:03:52+00:00">
<meta property="article:modified_time" content="2020-09-22T19:03:52+00:00">
<meta itemprop=name content="你應該擴充的 text object">
<meta itemprop=description content="vim 高效率編輯的背後，operator, motion, text object 的配合功不可沒。 operator 是編輯的動作， text object 就是文字區塊，motion 是跳轉到文件點，透過三者的按鍵配合"><meta itemprop=datePublished content="2020-09-22T19:03:52+00:00">
<meta itemprop=dateModified content="2020-09-22T19:03:52+00:00">
<meta itemprop=wordCount content="2768">
<meta itemprop=keywords content="vim,neovim,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="你應該擴充的 text object">
<meta name=twitter:description content="vim 高效率編輯的背後，operator, motion, text object 的配合功不可沒。 operator 是編輯的動作， text object 就是文字區塊，motion 是跳轉到文件點，透過三者的按鍵配合"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>amikai's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>amikai's blog</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>你應該擴充的 text object</h1>
<div class=post-meta>
<span class=post-time> 2020-09-22 </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title></h2>
<div class="post-toc-content always-active">
<nav id=TableOfContents></nav>
</div>
</div>
<div class=post-content>
<p>vim 高效率編輯的背後，operator, motion, text object 的配合功不可沒。</p>
<p>operator 是編輯的動作， text object 就是文字區塊，motion 是跳轉到文件點，透過三者的按鍵配合，就能達到所想及所得的編輯方式。</p>
<p>如果你有看過別人使用 vim ，通常會有這種想法：怎麼隨便按幾個鍵就刪這裡刪那裡複製這裡複製那裡，速度快到看不懂在幹嘛，而且還不會出錯，因為只要想好要做什麼，按鍵按下去就對了，這也是為什麼會高效率。說了一堆，反正就是 <del><strong>耍潮必備</strong></del>。</p>
<p>本篇將會提到:</p>
<ul>
<li>operator, text object, motion 的配合用法</li>
<li>內建 text object 的不足之處</li>
<li>擴充 text object 的 plugin</li>
<li>淺談 nvim-treesitter</li>
</ul>
<h1 id=operator--text-object>Operator & text object</h1>
<p>Vim 定義了多個 operator 最常用的就是:</p>
<ul>
<li><code>d</code> delete (刪除)</li>
<li><code>c</code> change (更改)</li>
<li><code>y</code> yank (複製)</li>
</ul>
<p><strong>operator</strong> 沒有配合 text object 或是 motion 是沒有意義的，想像一下使用了 <code>d</code> 刪除，但是沒告訴它要刪除什麼，就像有了鐵鎚不知道要打什麼。所以需要給 operator 一個目標，讓它要對誰做什麼。這個誰就有兩種，motion 和 text object。</p>
<p><strong>motion</strong>：其實就是跳轉指令，像是常用的 <code>G</code>,<code>gg</code>, <code>w</code>, <code>f{char}</code> &mldr; 等都可以配合 operator。基本使用方法為 <code>{operator}{motion}</code>，語意就是做這個 operator 動作到 motion 所到的地方</p>
<p>以 <code>d</code> operator 做舉例的話 (其他 operator 以此類推):</p>
<ul>
<li><code>dG</code>: 刪除 從游標到檔案的尾部</li>
<li><code>dgg</code>: 刪除 從游標到檔案的頭部</li>
<li><code>dw</code>: 刪除 從游標到下一個字</li>
<li><code>dfz</code>: 刪除 從游標底下到達此行 z 這個字母 (如果此行無 z 則不動作)</li>
</ul>
<p><strong>text object</strong>： 通常是已經定義的一個範圍，像是 word, quote, () block &mldr; 等。內建的 text object 都會有 i 或 a 為前輟，i 表示 inside (不包含的概念)、 a 表示 around (包含的概念)。</p>
<p>常用的 text object:</p>
<ul>
<li><code>iw</code> ：游標下的字不包含後面的空白 (英文斷字使用空白)</li>
<li><code>aw</code> ：游標下的字包含後面的空白 (英文斷字使用空白)</li>
<li><code>i"</code> ：游標下在雙引號裡的所有字不包含雙引號</li>
<li><code>a"</code> ：游標下在雙引號裡的所有字包含雙引號</li>
<li><code>i(</code>, <code>i)</code> ：游標下在小括號裡的所有字不包含小括號</li>
<li><code>a(</code>, <code>a)</code> ：游標下在小括號裡的所有字包含小括號</li>
</ul>
<p>基本使用方式為 <code>{operator}{text object}</code>，語意就是對此 text object 做這個operator 動作
使用 <code>d</code> operator 做舉例:</p>
<ul>
<li><code>diw</code> ：刪除 游標下的字不包含後面的空白 (英文斷字使用空白)</li>
<li><code>daw</code> ：刪除 游標下的字包含後面的空白 (英文斷字使用空白)</li>
<li><code>di"</code> ：刪除 游標下在雙引號裡的所有字不包含雙引號</li>
<li><code>da"</code> ：刪除 游標下在雙引號裡的所有字不包含雙引號</li>
<li><code>di(</code>, <code>di)</code> ：刪除 游標下在小括號裡的所有字不包含雙引號</li>
<li><code>da(</code>, <code>da)</code> ：刪除 游標下在小括號裡的所有字包含雙引號</li>
</ul>
<blockquote>
<p>建議自己把 <code>:help motion.txt</code> 翻一翻，找出自己常用的 text object 看一看，寫成一個 cheat sheet</p>
</blockquote>
<p>雖然 vim 定義了大量的 text object，但可能大部分都不是你想要的，那就透過 plugin 來滿足需求吧。</p>
<h1 id=簡單好用的-vim-textobj-user>簡單好用的 vim-textobj-user</h1>
<p>kana 所發展的 <a href=https://github.com/kana/vim-textobj-user>kana/vim-textobj-user</a> 是一個 lib，讓使用者藉由這個 lib 輕鬆的製作屬於自己的 text object，所以就有一些 plugin 基於此 lib 做出更多的 text object，這些 plugin 的名字通常都叫 vim-textobj-xxx 。</p>
<p>使用 plugin 的方法為：</p>
<ul>
<li>安裝 <a href=https://github.com/kana/vim-textobj-user>kana/vim-textobj-user</a></li>
<li>在 <a href=https://github.com/kana/vim-textobj-user/wiki>wiki</a> 裡查看自己所需的 text object plugin，並且安裝</li>
</ul>
<p>舉例來說：我最常用的兩個 text object 是 comment 和 funtion parameter，所以我選定 <a href=https://github.com/glts/vim-textobj-comment>glts/vim-textobj-comment</a> 和 <a href=https://github.com/sgur/vim-textobj-parameter>sgur/vim-textobj-parameter</a></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=nx>Plug</span> <span class=s1>&#39;kana/vim-textobj-user&#39;</span><span class=err>
</span><span class=err></span><span class=nx>Plug</span> <span class=s1>&#39;glts/vim-textobj-comment&#39;</span><span class=err>
</span><span class=err></span><span class=nx>Plug</span> <span class=s1>&#39;sgur/vim-textobj-parameter&#39;</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>vim-textobj-comment 提供了：</p>
<ul>
<li><code>ic</code>：comment 內容</li>
<li><code>ac</code>：comment 內容 + comment 符號</li>
</ul>
<p>vim-textobj-parameter 提供了：</p>
<ul>
<li><code>i,</code>：參數</li>
<li><code>a,</code>：參數符號 + 分隔符號 (也就是逗號)</li>
</ul>
<h1 id=更細膩的-text-object---targetsvim>更細膩的 text object - targets.vim</h1>
<p><a href=https://github.com/wellle/targets.vim>wellle/targets.vim</a> 把 text object 的種類拆成四類型：</p>
<ul>
<li>Pair text objects - <code>(</code> <code>)</code> <code>{</code> <code>}</code> <code>[</code> <code>]</code> <code>&lt;</code> <code>></code></li>
<li>Quote text objects - <code>'</code> <code>"</code> <code>`</code></li>
<li>Separator text objects - <code>, . ; : + - = ~ _ * # / | \ & $</code></li>
<li>Argument text objects</li>
<li>Tag text objects</li>
</ul>
<p>Pair 和 Quote text objects 是 vim 原本就有的概念，Separator text objects 如其名，兩個 separator 之間的字就是 Separator text objects 了。
舉個使用情境：url GET 參數都用 <code>&</code> 所隔開，如果想刪除 <code>&</code> 之間的字那就用得上了</p>
<p>內建的 text object 使用了 i 和 a 做前輟，而 targets.vim 更為細膩，提供了額外的 I 和 A 擴充原本的 i 和 a，再加上一層概念 <code>n</code> 和 <code>l</code>，<code>n</code> 代表下一個，<code>l</code> 則代表上一個。</p>
<p>註：內建的 text object 都是以游標位置為準，沒上一個和下一個的概念</p>
<p>以 <code>)</code> 做個舉例：</p>
<ul>
<li><code>i)</code>：包含括號裡的所有字</li>
<li><code>I)</code>：包含括號裡的所有字，但括號裡兩邊的空白不包含</li>
<li><code>a)</code>：包含括號和括號裡的所有字</li>
<li><code>A)</code>：包含括號和括號裡的所有字還有兩邊括號外的空白</li>
</ul>
<p>加上 <code>n</code> 和 <code>l</code> 的話就是下一個跟上一個</p>
<p><code>.</code> 表示游標所在位置</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>                           ..........
a ( b ( cccccccc ) d ) ( e ( ffffff ) g ) ( h ( iiiiiiii ) j ) k
  │││ ││└ 2Il) ┘││││││││││ ││└ I) ┘││││││││││ ││└ 2In) ┘│││││││
  │││ │└─ 2il) ─┘│││││││││ │└─ i) ─┘│││││││││ │└─ 2in) ─┘││││││
  │││ ├── 2al) ──┘││││││││ ├── a) ──┘││││││││ ├── 2an) ──┘│││││
  │││ └── 2Al) ───┘│││││││ └── A) ───┘│││││││ └── 2An) ───┘││││
  ││└───── Il) ────┘│││││└─── 2I) ────┘│││││└───── In) ────┘│││
  │└────── il) ─────┘│││└──── 2i) ─────┘│││└────── in) ─────┘││
  ├─────── al) ──────┘│├───── 2a) ──────┘│├─────── an) ──────┘│
  └─────── Al) ───────┘└───── 2A) ───────┘└─────── An) ───────┘
</code></pre></td></tr></table>
</div>
</div><p>target.vim 提供的 text object 實在太多太複雜，所以很貼心的做了 <a href=https://github.com/wellle/targets.vim/blob/master/cheatsheet.md>cheat sheet</a></p>
<h1 id=syntax-相關-text-object>syntax 相關 text object</h1>
<p>以上所提到的 text object 都是和程式語言較無相關的 text object。程式語言相關的 text object，比如說 function, class, structure⋯⋯，這些相關的 text object plugin 相對來說比較少見。</p>
<p>vim 並沒有提供一個介面直接拿取 syntax tree 的某一個 node，所以現在的所有 text object 的 plugin 都是靠 regex 或是其他字串比對的方式。假如想要一個 function 的 text object，就必須在每種語言都用 regex 或字串比對做一遍，相當的麻煩，<a href=https://github.com/kana/vim-textobj-function>kana/vim-textobj-function</a> 就是一個例子，目前只提供三種語言，並且每種語言實做一次。</p>
<p>一個 text object 為主的 plugin 想要集成所有的 syntax 相關 text object 變得不太可能，所以這些 syntax 相關 text object plugin 通常都已一種語言為主，或是附屬在某些語言 plugin 底下：</p>
<ul>
<li>vim-go 提供了 comment (<code>ac</code>, <code>ic</code>) 和 function (<code>af</code>, <code>if</code>) text object</li>
<li><a href=https://github.com/sgur/vim-textobj-parameter>sgur/vim-textobj-parameter</a> 為 python syntax 相關的 text object</li>
<li><a href=https://github.com/mjbrownie/django-template-textobjects>mjbrownie/django-template-textobjects</a> 為 django-template 相關的 text object</li>
</ul>
<h1 id=救世主-treesitter>救世主 treesitter</h1>
<p>一個 text object 為主的 plugin 想要集成所有的 syntax 相關 text object 真的不可能達到嗎？
等到 Treesitter 被 neovim 整合完成後一切將變得簡單許多。</p>
<p>Treesitter 簡單來講就是個 parser，可以使用它建立 syntax tree，官方介紹如下：
Tree-sitter is a parser generator tool and an incremental parsing library. It can build a concrete syntax tree for a source file and efficiently update the syntax tree as the source file is edited</p>
<p>neovim 0.5 版的目標就是要將 treesitter 整合，完成之後將可在 neovim 裡使用 treesitter 相關的 api，拿到了 syntax tree， 要抓到 text object 變得容易許多。別說做 text object plugin 了，連 syntax highlight, code folding 等相關 plugin 都可以不需倚賴 regex ，而目前已經有基於 treesitter 的 plugin 了：
<strong><a href=https://github.com/nvim-treesitter/nvim-treesitter>nvim-treesitter/nvim-treesitter</a></strong></p>
<p>詳見 <code>:help treesitter-parsers</code></p>
<h1 id=結語>結語</h1>
<p><a href=https://github.com/wellle/targets.vim>wellle/targets.vim</a> 和 <a href=https://github.com/kana/vim-textobj-user>kana/vim-textobj-user</a> 在開發上使用截然不同的方式，前者定義好大量細膩的 text object，後者則是一個 lib，由使用者以此 lib 為基礎在開發 plugin。</p>
<p>對我來說，內建的 text object 已經足夠強大幾乎滿足需求，只需要在做一點補強，像是常用的 comment 和 funtion parameter 就沒有被 vim 定義。而 target.vim 大量細膩的 text object 使用情境都比較特殊，所以我就選擇了 vim-textobj-user 陣營——只選擇自己所需要的安裝，不會有多餘的功能。</p>
<p><a href=https://github.com/nvim-treesitter/nvim-treesitter>nvim-treesitter/nvim-treesitter</a> 倚賴 syntax tree 解決了使用 regex 開發 text object plugin 的麻煩，而且更精準，可以預見 neovim 0.5 完成後的未來，syntax 相關的 text object plugin 將會被此 plugin 統一。</p>
<h1 id=reference>Reference</h1>
<ul>
<li><a href=https://codeinthehole.com/tips/vim-text-objects/>https://codeinthehole.com/tips/vim-text-objects/</a></li>
<li><a href=https://www.tandrewnichols.me/motions-operators-text-objects-introduction/>https://www.tandrewnichols.me/motions-operators-text-objects-introduction/</a></li>
<li><a href=https://neovim.io/doc/user/motion.html><code>:help 'motion.txt'</code></a></li>
</ul>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/vim/>vim</a>
<a href=/tags/neovim/>neovim</a>
</div>
<nav class=post-nav>
<a class=prev href=/2020/09/29/vim-tips-highlight-yank-region/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">vim 高亮 yank 區域</span>
<span class="prev-text nav-mobile"></span>
</a>
<a class=next href=/2020/09/10/vim-make/>
<span class="next-text nav-default">誰說不能在 vim 裡編譯，從 :make 到 :Make</span>
<span class="next-text nav-mobile"></span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<script src=https://utteranc.es/client.js repo=amikai/my_hugo_blog_utterances issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://www.linkedin.com/in/yun-kai-chuang-122064a5/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/amikai class="iconfont icon-github" title=github></a>
<a href=https://amikai.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
%!(EXTRA string=<a class=hexo-link href=https://gohugo.io>Hugo</a>)
</span>
<span class=division>|</span>
<span class=theme-info>
-
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<span class=copyright-year>
&copy;
-
2022<span class=heart><i class="iconfont icon-heart"></i></span><span></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/lib/fancybox/jquery.fancybox-3.1.20.min.js></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-172478407-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</body>
</html>