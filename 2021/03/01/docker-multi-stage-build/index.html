<!doctype html><html lang=zh>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Dockerfile - Multi-stage build 筆記 - amikai's blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content><meta name=description content="在專案開發時，通常會執行代碼檢查、單元測試、編譯、執行等等。 在 docker 還沒出現之前，這些流程都是在本機上跑 (版本 0)，因為環境的不一致可能導致不同"><meta name=keywords content="go 語言 neovim 環境設定,kubernetes,golang,k8s,neovim">
<meta name=generator content="Hugo 0.87.0 with theme even">
<link rel=canonical href=https://amikai.github.io/2021/03/01/docker-multi-stage-build/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css rel=stylesheet>
<link href=/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet>
<meta property="og:title" content="Dockerfile -  Multi-stage build 筆記">
<meta property="og:description" content="在專案開發時，通常會執行代碼檢查、單元測試、編譯、執行等等。 在 docker 還沒出現之前，這些流程都是在本機上跑 (版本 0)，因為環境的不一致可能導致不同">
<meta property="og:type" content="article">
<meta property="og:url" content="https://amikai.github.io/2021/03/01/docker-multi-stage-build/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-03-01T21:57:33+00:00">
<meta property="article:modified_time" content="2021-03-01T21:57:33+00:00">
<meta itemprop=name content="Dockerfile -  Multi-stage build 筆記">
<meta itemprop=description content="在專案開發時，通常會執行代碼檢查、單元測試、編譯、執行等等。 在 docker 還沒出現之前，這些流程都是在本機上跑 (版本 0)，因為環境的不一致可能導致不同"><meta itemprop=datePublished content="2021-03-01T21:57:33+00:00">
<meta itemprop=dateModified content="2021-03-01T21:57:33+00:00">
<meta itemprop=wordCount content="1822">
<meta itemprop=keywords content="docker,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Dockerfile -  Multi-stage build 筆記">
<meta name=twitter:description content="在專案開發時，通常會執行代碼檢查、單元測試、編譯、執行等等。 在 docker 還沒出現之前，這些流程都是在本機上跑 (版本 0)，因為環境的不一致可能導致不同"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>amikai's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a>
</ul>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>amikai's blog</a>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>Dockerfile - Multi-stage build 筆記</h1>
<div class=post-meta>
<span class=post-time> 2021-03-01 </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title></h2>
<div class="post-toc-content always-active">
<nav id=TableOfContents></nav>
</div>
</div>
<div class=post-content>
<p>在專案開發時，通常會執行代碼檢查、單元測試、編譯、執行等等。</p>
<p>在 docker 還沒出現之前，這些流程都是在本機上跑 (版本 0)，因為環境的不一致可能導致不同主機執行結果不相同。將這些流程步驟撰寫成 dockerfile 直接在容器裡執行就可以解決上述問題 (版本 1)，但也衍伸出了新的問題。為了執行代碼檢查和編譯，下載了許多套件或是相依工具，造成映像檔肥大，很多套件或是相依工具在部署時是不需要的。</p>
<p>如果把這些步驟拆成兩個階段思考 (版本 2)</p>
<ul>
<li>開發整合階段：代碼檢查、單元測試、編譯等等使用。</li>
<li>部署階段：跑起執行檔，將此兩階段寫成兩個 dockerfile，並且建構出兩個映像檔，只要拿後者映像檔去部署即可。
版本 2 成功解決了部署映像檔大小的問題，可是在必須維護兩個 dockerfile 還有中間流程所需的 script，Docker 17.05 所推出的 Multi-stage build 正好能解決此問題 (版本 3)。</li>
</ul>
<p>以下則是 版本 0 進化到 版本 3 的過程及解釋。</p>
<h1 id=範例-go-專案版本-0沒使用-docker>範例 go 專案，版本 0：沒使用 docker</h1>
<p>此專案使用 gin 實作 http server 只要對它請求 <code>GET /ping</code> ，則會回覆 pong，
以下是專案結構：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>&gt; tree example
example
├── go.mod
├── go.sum
├── main.go
└── main_test.go 
</code></pre></td></tr></table>
</div>
</div><p>在完成程式碼撰寫之後，執行以下步驟</p>
<ol>
<li>使用 go vet 檢查</li>
<li>使用 staticcheck 檢查</li>
<li>跑完測試</li>
<li>編譯專案</li>
<li>執行</li>
</ol>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ go vet ./...
$ staticcheck ./...
$ go test ./...
$ go build -o ./server
$ ./server
</code></pre></td></tr></table>
</div>
</div><h1 id=dockerfile-版本一-全部都塞在一個映像檔>Dockerfile 版本一： 全部都塞在一個映像檔</h1>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=k>FROM</span><span class=s> golang:1.16.0-alpine3.13</span><span class=err>
</span><span class=err></span><span class=c># go module</span><span class=err>
</span><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span>

<span class=c># install staticcheck binary</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go install honnef.co/go/tools/cmd/staticcheck@v0.1.2<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /workspace/example</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># download dependency</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> go.mod go.sum .<span class=err>
</span><span class=err></span><span class=k>RUN</span>  go mod download<span class=err>
</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># Copy source code</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> . ./<span class=err>
</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go vet ./... <span class=o>&amp;&amp;</span> staticcheck ./... <span class=o>&amp;&amp;</span> go <span class=nb>test</span> ./... <span class=o>&amp;&amp;</span> go build -o /bin/server<span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>把映像檔做出來</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ docker image build -t amikai/example:v1  .
</code></pre></td></tr></table>
</div>
</div><p>為了要對此專案進行代碼檢查和編譯，必須將相關工具以及依賴下載好，而這些依賴及工具都會佔用到空間，觀察 container 裡 <code>/go</code> (go 相關依賴) 就佔了 328.7 MB (使用 <code>du -sh /go</code> 觀察)，而整個映像檔是 687 MB，映像檔大小還有相當大的改善空間。</p>
<h1 id=dockerfile-版本二拆成兩個階段思考>Dockerfile 版本二：拆成兩個階段思考</h1>
<p>把版本一的 dockfile 拆成兩個階段思考：</p>
<ul>
<li>從建構的階段來想：為了確保每個人在代碼檢查以及編譯的環境是統一的，減少環境不同所造成的問題。</li>
<li>從部署的階段來想：最後只要留下需要編譯後所產生的執行檔，其他相關的依賴和工具都是不必要的，編譯完後放在那只是佔位置。</li>
</ul>
<p>把這兩個階段的事情，拆成兩個映像檔：</p>
<ul>
<li>建構階段 (Dockerfile)：此階段是對原始碼進行檢查及編譯等等，不太需要考慮映像檔大小，反正不會拿去部署。</li>
<li>部署階段 (Dockerfile.build)： 此在意的是映像檔大小，所以留下編譯後的執行檔即可。</li>
</ul>
<p>具體的做法就是先做出一個 <code>Dockerfile.build</code> 去 build 出執行檔，把此執行檔取出，再寫一個 <code>Dockerfile</code> 將此執行檔放入，開始執行。在使用一個 <code>build.sh</code> 將上述事情自動化。</p>
<p>Dockerfile.build</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-docker data-lang=docker><span class=k>FROM</span><span class=s> golang:1.16.0-alpine3.13</span><span class=err>
</span><span class=err></span><span class=c># go module</span><span class=err>
</span><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span>

<span class=c># install staticcheck binary</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go install honnef.co/go/tools/cmd/staticcheck@v0.1.2<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /workspace/example</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># download dependency</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> go.mod go.sum .<span class=err>
</span><span class=err></span><span class=k>RUN</span>  go mod download<span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># Copy source code</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> . ./<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>RUN</span> go vet ./... <span class=o>&amp;&amp;</span> staticcheck ./... <span class=o>&amp;&amp;</span> go <span class=nb>test</span> ./... <span class=o>&amp;&amp;</span> go build -o /bin/server<span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>Dockerfile</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=k>FROM</span><span class=s> alpine:latest</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /root/</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> server .<span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;./server&#34;</span><span class=p>]</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>build.sh</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/bin/sh
</span><span class=cp></span><span class=nb>echo</span> Building amikai/example:build

docker build -t amikai/example:build . -f Dockerfile.build
docker container create --name extract amikai/example:build 
docker container cp extract:/bin/server ./server
docker container rm -f extract

<span class=nb>echo</span> Building amikai/example:v2
docker image build --no-cache -t amikai/example:v2  .
</code></pre></td></tr></table>
</div>
</div><p>執行 build.sh 將 example:v2 的映像檔做出來，這個映像檔大小是 15 MB，已經和版本一的 687 MB 有很大的進步空間。</p>
<p>雖然最終產出的映像檔大小有極大的改善，但為了這個映像檔，必須維護三個檔案，在微服務的世界裡，如果一個容器裝一個服務，就必須維護 服務數量 * 3 的檔案。</p>
<p>而且是兩個映像檔分別都會佔用到硬碟空間，也就是說雖然拿來部署的映像檔改善了大小，但總體佔用的硬碟空間和版本一是幾乎一樣的。</p>
<h1 id=dockerfile-版本三-multi-stage-builds>Dockerfile 版本三： multi-stage builds</h1>
<p>docker 在 17.05 提出 multi-stage builds，整個 dockerfile 可以分割成好幾個 stage，每個 stage 由 <code>FROM</code> 作為開始，也就是說 <code>FROM</code> 除了選擇基底映像檔之外，還有新 stage 起始的意義。</p>
<p>multi-stage 功能讓我們可以將此 stage 所需要的檔案，複製到下個 stage 做其他事，則最終做出來的映像檔只會留下所需的檔案。</p>
<p>版本三的 dockerfile 如下，有兩個 stage:</p>
<ol>
<li>builder stage: 以 golang 為基底的映像檔，用來做原始碼檢查、測試，並且編譯出執行檔</li>
<li>release stage: 將 builder stage 的執行檔複製過來，並且執行</li>
</ol>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=k>FROM</span><span class=s> golang:1.16.0-alpine3.13 AS builder</span><span class=err>
</span><span class=err></span><span class=k>WORKDIR</span><span class=s> /workspace/example</span><span class=err>
</span><span class=err></span><span class=k>ENV</span> <span class=nv>GO111MODULE</span><span class=o>=</span>on <span class=nv>CGO_ENABLED</span><span class=o>=</span><span class=m>0</span>
<span class=c># download dependency</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> go.mod go.sum .<span class=err>
</span><span class=err></span><span class=k>RUN</span>  go mod download<span class=err>
</span><span class=err></span><span class=k>RUN</span> go install honnef.co/go/tools/cmd/staticcheck@v0.1.2<span class=err>
</span><span class=err></span><span class=k>COPY</span> . .<span class=err>
</span><span class=err></span><span class=k>RUN</span> go vet ./... <span class=o>&amp;&amp;</span> staticcheck ./... <span class=o>&amp;&amp;</span> go <span class=nb>test</span> ./... <span class=o>&amp;&amp;</span> go build -o /bin/server<span class=err>
</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=k>FROM</span><span class=s> alpine:latest AS release</span><span class=err>
</span><span class=err></span><span class=c># Copy from builder</span><span class=err>
</span><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>builder /bin/server /bin/server<span class=err>
</span><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;./bin/server&#34;</span><span class=p>]</span><span class=err>
</span></code></pre></td></tr></table>
</div>
</div><p>把映像檔做出來</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ docker image build -t amikai/example:v3  .
</code></pre></td></tr></table>
</div>
</div><p>版本三的映像檔大小為 15 MB，解決了版本二不需要維護三個檔案也解決了版本一產出肥大映像檔的痛點。multi-stage builds 真是個有感的功能呀。</p>
<h1 id=實驗環境>實驗環境</h1>
<p>golang</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback> $ go version
go version go1.16 darwin/amd64
</code></pre></td></tr></table>
</div>
</div><p>docker</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback> $ docker version
Client: Docker Engine - Community
 Cloud integration: 1.0.7
 Version:           20.10.2
 API version:       1.41
 Go version:        go1.13.15
 Git commit:        2291f61
 Built:             Mon Dec 28 16:12:42 2020
 OS/Arch:           darwin/amd64
 Context:           default
 Experimental:      true

Server: Docker Engine - Community
 Engine:
  Version:          20.10.2
  API version:      1.41 (minimum version 1.12)
  Go version:       go1.13.15
  Git commit:       8891c58
  Built:            Mon Dec 28 16:15:28 2020
  OS/Arch:          linux/amd64
  Experimental:     false
 containerd:
  Version:          1.4.3
  GitCommit:        269548fa27e0089a8b8278fc4fc781d7f65a939b
 runc:
  Version:          1.0.0-rc92
  GitCommit:        ff819c7e9184c13b7c2607fe6c30ae19403a7aff
 docker-init:
  Version:          0.19.0
  GitCommit:        de40ad0
 Kubernetes:
  Version:          v1.16.15-gke.7800
  StackAPI:         Unknown
</code></pre></td></tr></table>
</div>
</div><p>此為範例專案最終完成版，並且可以透過 git 記錄看到版本一和版本二的內容。
<img src=example.tar.gz alt></p>
<p>sha256sum</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>5321e3a3d67195f7c44f7c1e76ca229717fcd49ebb3359528038745670f68aba  example.tar.gz
</code></pre></td></tr></table>
</div>
</div><h1 id=reference>Reference</h1>
<ul>
<li><a href=https://docs.docker.com/develop/develop-images/multistage-build/>https://docs.docker.com/develop/develop-images/multistage-build/</a></li>
<li><a href=https://tachingchen.com/tw/blog/building-minimal-docker-image-for-go-applications/>打造最小 Go Docker Image</a></li>
<li><a href=https://blog.alexellis.io/mutli-stage-docker-builds/>https://blog.alexellis.io/mutli-stage-docker-builds/</a></li>
<li><a href=https://www.docker.com/blog/tag/go-env-series/>https://www.docker.com/blog/tag/go-env-series/</a></li>
<li><a href=https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md>https://github.com/moby/buildkit/blob/master/frontend/dockerfile/docs/syntax.md</a></li>
<li><a href=https://www.ctl.io/developers/blog/post/more-docker-image-cache-tips/>https://www.ctl.io/developers/blog/post/more-docker-image-cache-tips/</a></li>
<li><a href=https://rock-it.pl/how-to-write-excellent-dockerfiles/>How to write excellent Dockerfiles</a></li>
</ul>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/docker/>docker</a>
</div>
<nav class=post-nav>
<a class=prev href=/2021/05/23/vim-virtualedit/>
<i class="iconfont icon-left"></i>
<span class="prev-text nav-default">好用的 vim virtualedit 選項</span>
<span class="prev-text nav-mobile"></span>
</a>
<a class=next href=/2020/11/28/vim-c-env-move/>
<span class="next-text nav-default">在 (neo)vim 裡 C 語言程式碼導覽技巧</span>
<span class="next-text nav-mobile"></span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<script src=https://utteranc.es/client.js repo=amikai/my_hugo_blog_utterances issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://www.linkedin.com/in/yun-kai-chuang-122064a5/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/amikai class="iconfont icon-github" title=github></a>
<a href=https://amikai.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
%!(EXTRA string=<a class=hexo-link href=https://gohugo.io>Hugo</a>)
</span>
<span class=division>|</span>
<span class=theme-info>
-
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<span class=copyright-year>
&copy;
-
2021<span class=heart><i class="iconfont icon-heart"></i></span><span></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/lib/fancybox/jquery.fancybox-3.1.20.min.js></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-172478407-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</body>
</html>