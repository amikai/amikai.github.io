<!doctype html><html lang=zh>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<title>Golang 開發環境 - 使用 neovim 0.5 - amikai's blog</title>
<meta name=renderer content="webkit">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<meta http-equiv=cache-control content="no-transform">
<meta http-equiv=cache-control content="no-siteapp">
<meta name=theme-color content="#f8f5ec">
<meta name=msapplication-navbutton-color content="#f8f5ec">
<meta name=apple-mobile-web-app-capable content="yes">
<meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec">
<meta name=author content><meta name=description content="Neovim 簡介 neovim 從 vim 專案 fork 之後，新增了 async 功能，所有工作不會再被單一線程給擋住 (在過去 linter 檢查時，是無法寫程式碼的)，大大提升了可用性和使用者體驗，朝現"><meta name=keywords content="go 語言 neovim 環境設定,kubernetes,golang,k8s,neovim">
<meta name=generator content="Hugo 0.86.0 with theme even">
<link rel=canonical href=https://amikai.github.io/2021/08/16/go_neovim_env_0.5/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link href=/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css rel=stylesheet>
<link href=/lib/fancybox/jquery.fancybox-3.1.20.min.css rel=stylesheet>
<meta property="og:title" content="Golang 開發環境 - 使用 neovim 0.5">
<meta property="og:description" content="Neovim 簡介 neovim 從 vim 專案 fork 之後，新增了 async 功能，所有工作不會再被單一線程給擋住 (在過去 linter 檢查時，是無法寫程式碼的)，大大提升了可用性和使用者體驗，朝現">
<meta property="og:type" content="article">
<meta property="og:url" content="https://amikai.github.io/2021/08/16/go_neovim_env_0.5/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-08-16T15:20:34+08:00">
<meta property="article:modified_time" content="2021-08-16T15:20:34+08:00">
<meta itemprop=name content="Golang 開發環境 - 使用 neovim 0.5">
<meta itemprop=description content="Neovim 簡介 neovim 從 vim 專案 fork 之後，新增了 async 功能，所有工作不會再被單一線程給擋住 (在過去 linter 檢查時，是無法寫程式碼的)，大大提升了可用性和使用者體驗，朝現"><meta itemprop=datePublished content="2021-08-16T15:20:34+08:00">
<meta itemprop=dateModified content="2021-08-16T15:20:34+08:00">
<meta itemprop=wordCount content="2220">
<meta itemprop=keywords content="vim,neovim,"><meta name=twitter:card content="summary">
<meta name=twitter:title content="Golang 開發環境 - 使用 neovim 0.5">
<meta name=twitter:description content="Neovim 簡介 neovim 從 vim 專案 fork 之後，新增了 async 功能，所有工作不會再被單一線程給擋住 (在過去 linter 檢查時，是無法寫程式碼的)，大大提升了可用性和使用者體驗，朝現"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<div id=mobile-navbar class=mobile-navbar>
<div class=mobile-header-logo>
<a href=/ class=logo>amikai's blog</a>
</div>
<div class=mobile-navbar-icon>
<span></span>
<span></span>
<span></span>
</div>
</div>
<nav id=mobile-menu class="mobile-menu slideout-menu">
<ul class=mobile-menu-list>
<a href=/>
<li class=mobile-menu-item>Home</li>
</a><a href=/post/>
<li class=mobile-menu-item>Archives</li>
</a><a href=/tags/>
<li class=mobile-menu-item>Tags</li>
</a><a href=/categories/>
<li class=mobile-menu-item>Categories</li>
</a>
</ul>
<div class=language-selector>
<ul class=languages-list>
<li class="language-item active">
<a href=https://amikai.github.io/2021/08/16/go_neovim_env_0.5/>zh</a>
</li>
<li class=language-item>
<a href=https://amikai.github.io/en/>en</a>
</li>
</ul>
</div>
</nav>
<div class=container id=mobile-panel>
<header id=header class=header>
<div class=logo-wrapper>
<a href=/ class=logo>amikai's blog</a>
</div>
<div class=language-selector>
<ul class=languages-list>
<li class="language-item active">
<a href=https://amikai.github.io/2021/08/16/go_neovim_env_0.5/>zh</a>
</li>
<li class=language-item>
<a href=https://amikai.github.io/en/>en</a>
</li>
</ul>
</div>
<nav class=site-navbar>
<ul id=menu class=menu>
<li class=menu-item>
<a class=menu-item-link href=/>Home</a>
</li><li class=menu-item>
<a class=menu-item-link href=/post/>Archives</a>
</li><li class=menu-item>
<a class=menu-item-link href=/tags/>Tags</a>
</li><li class=menu-item>
<a class=menu-item-link href=/categories/>Categories</a>
</li>
</ul>
</nav>
</header>
<main id=main class=main>
<div class=content-wrapper>
<div id=content class=content>
<article class=post>
<header class=post-header>
<h1 class=post-title>Golang 開發環境 - 使用 neovim 0.5</h1>
<div class=post-meta>
<span class=post-time> 2021-08-16 </span>
</div>
</header>
<div class=post-toc id=post-toc>
<h2 class=post-toc-title></h2>
<div class="post-toc-content always-active">
<nav id=TableOfContents>
<ul>
<li><a href=#color-scheme>Color scheme</a></li>
<li><a href=#file-explorer---nerdtree>File explorer - nerdtree</a></li>
<li><a href=#vim-go>vim-go</a></li>
<li><a href=#auto-complete>Auto-complete</a></li>
<li><a href=#code-navigation---vim-go>Code navigation - vim-go</a></li>
<li><a href=#background-compile---vim-go>Background compile - vim-go</a></li>
<li><a href=#code-format---vim-go>Code format - vim-go</a></li>
<li><a href=#async-linter---使用-nvim-lspconfig>Async linter - 使用 nvim-lspconfig</a></li>
<li><a href=#code-outline---tagbar>Code outline - tagbar</a></li>
<li><a href=#fuzzy-finder---telescope>Fuzzy finder - Telescope</a></li>
</ul>
</nav>
</div>
</div>
<div class=post-content>
<h1 id=neovim-簡介>Neovim 簡介</h1>
<p>neovim 從 vim 專案 fork 之後，新增了 async 功能，所有工作不會再被單一線程給擋住 (在過去 linter 檢查時，是無法寫程式碼的)，大大提升了可用性和使用者體驗，朝現代編輯器躍進了一大步。neovim 並沒有因此停下腳步，在之後的版本陸續推出了</p>
<ul>
<li>
<p>remote plugin：使得寫 plugin 不在受限於 vimscript，可以使用其他語言並且基於 client server 架構和 neovim 溝通，這樣就能好好的利用各個語言生態系的工具，製作出更多有彈性的套件。ex: deoplete.nvim 和 defx.nvim 皆是 python 所撰寫的 remote plugin</p>
</li>
<li>
<p>treesitter 的支援：過去 vim 的 syntax highlight 都是靠 regex，現在可以使用 treesitter ，效能更好，抓詞的時候更準確</p>
</li>
<li>
<p>支援 lua 寫套件：可以完全使用 lua 撰寫套件 ，脫離怪異的 vimscript，和 remote plugin 不同，remote plugin 是基於 client server 架構通訊</p>
</li>
<li>
<p>built-in LSP client (0.5)：內建 LSP client，使用者可以透過 neovim LSP api 和 LSP server 互動</p>
</li>
</ul>
<p>2021 的 0.5 版本發佈，除了古老的文字介面，neovim 可說是不折不扣的現代編輯器。</p>
<h1 id=編輯器基本功能>編輯器基本功能</h1>
<p>一個現代的編輯器應該有以下幾種基本功能：</p>
<ul>
<li>
<p>客製化 Color scheme</p>
</li>
<li>
<p>Auto completion - 自動補全引擎</p>
</li>
<li>
<p>File manager - 可以在側邊欄看到專案的結構</p>
</li>
<li>
<p>Async linter - 在寫程式碼犯錯的同時，有錯誤提示</p>
</li>
<li>
<p>Background compile - 編譯的同時不應該卡住整個 Editor，要讓使用者能做其他事情</p>
</li>
<li>
<p>Code navigation - 包含跳轉到定義，跳轉到型態定義</p>
</li>
<li>
<p>Code outliner - 當一個檔案寫得很長的時候，怎麼綜觀全局，並且在這些函式中快速跳轉</p>
</li>
<li>
<p>Fuzzy Finder - 透過 fuzzy finder 找到想要的檔案或是專案裡的字串等等</p>
</li>
</ul>
<p>本篇將會使用短小的 lua 設定檔達到基礎 go 語言的開發環境，並產出 init.lua 檔案</p>
<h1 id=預備動作>預備動作</h1>
<ul>
<li>
<p>安裝 neovim 0.5 stable</p>
</li>
<li>
<p>知道在 neovim 中如何使用 lua，可參考 <a href=https://github.com/nanotee/nvim-lua-guide>nanotee/nvim-lua-guide</a></p>
</li>
<li>
<p>知道如何使用 <a href=https://github.com/wbthomason/packer.nvim>packer.nvim</a> 管理套件</p>
</li>
</ul>
<h1 id=initlua-設置>init.lua 設置</h1>
<h2 id=color-scheme>Color scheme</h2>
<p>選一個適合自己眼睛的主題吧，推薦 <code>gruvbox-material</code></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>use</span> <span class=p>{</span>
    <span class=s1>&#39;sainnhe/gruvbox-material&#39;</span><span class=p>,</span>
    <span class=n>setup</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
        <span class=n>vim.g</span><span class=p>.</span><span class=n>gruvbox_material_background</span> <span class=o>=</span> <span class=s1>&#39;soft&#39;</span>
    <span class=kr>end</span><span class=p>,</span>
    <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
        <span class=n>vim.cmd</span><span class=s>[[colorscheme gruvbox-material]]</span>
    <span class=kr>end</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=file-explorer---nerdtree>File explorer - nerdtree</h2>
<p><img src=nerdtree.png alt=nerdtree></p>
<p>雖然在<a href=https://amikai.github.io/2020/09/03/go_neovim_env/>上篇</a>我不推薦使用 nerdtree，並且端出了需要高度手動配置的 defx.nvim。經過仔細思考之後發現這是個人偏好，不應該拉讀者一起折騰，沒有什麼特殊需求的話，大部分的情況下 nerdtree 是很夠用的，使用者體驗也不錯。</p>
<p>安裝 nerdtree</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>use</span> <span class=p>{</span>
	<span class=s1>&#39;preservim/nerdtree&#39;</span><span class=p>,</span>
    <span class=n>setup</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
    	<span class=c1>-- Read the following nerdtree section and add what you need</span>
    <span class=kr>end</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>映射 <code>&lt;F4></code> 打開或關閉 nerdtree</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;F4&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;cmd&gt;NERDTreeToggle&lt;cr&gt;&#34;</span> <span class=p>,{</span><span class=n>silent</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
</code></pre></td></tr></table>
</div>
</div><p>在 nerdtree 只要會使用兩個按鍵就能存活</p>
<ul>
<li>
<p><code>?</code> 打開 quick menu 列出所有基本的案鍵映射</p>
</li>
<li>
<p><code>m</code> 對游標下的檔案或檔案夾列出基本操作選單</p>
</li>
</ul>
<h2 id=vim-go>vim-go</h2>
<p>強大的 vim-go 提供了各式各樣 go 語言的開發功能，包括了 auto completion, code navigation, background compilation, code format 的功能，我將會介紹 vim-go 如何使用這些功能</p>
<p>安裝 vim-go</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>use</span> <span class=p>{</span>
    <span class=s1>&#39;fatih/vim-go&#39;</span><span class=p>,</span>
    <span class=n>run</span> <span class=o>=</span> <span class=s1>&#39;:GoUpdateBinaries&#39;</span><span class=p>,</span>
    <span class=n>ft</span> <span class=o>=</span> <span class=s1>&#39;go&#39;</span><span class=p>,</span>
    <span class=n>setup</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
    	<span class=c1>-- Read the following section and add what you need</span>
	<span class=kr>end</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=auto-complete>Auto-complete</h2>
<p>vim-go 提供了 auto completion 使用 omnifunc 實作 (<code>:help omnifunc</code>)，omnifunc 使用 <code>&lt;c-x>&lt;c-o></code> 觸發並彈出候選補全選單，<code>&lt;c-x>&lt;c-o></code> 按起來很不順手，為了更好的體驗，將設定成：</p>
<ul>
<li>
<p><code>&lt;tab></code> 觸發候補選單或是跳到下一個候選，沒有候選時就輸出 tab 字元</p>
</li>
<li>
<p><code>&lt;s-tab></code> 觸發候補選單或跳到上一個候選，沒有候選時就刪除 tab 字元</p>
</li>
<li>
<p><code>&lt;enter></code> 完成補全，沒有候選時就輸出下一行</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=kd>local</span> <span class=n>t</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>str</span><span class=p>)</span>
    <span class=kr>return</span> <span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_replace_termcodes</span><span class=p>(</span><span class=n>str</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=kc>true</span><span class=p>)</span>
<span class=kr>end</span>

<span class=kd>local</span> <span class=n>check_back_space</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
    <span class=kd>local</span> <span class=n>col</span> <span class=o>=</span> <span class=n>vim.fn</span><span class=p>.</span><span class=n>col</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span>
    <span class=kr>if</span> <span class=n>col</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>or</span> <span class=n>vim.fn</span><span class=p>.</span><span class=n>getline</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>):</span><span class=n>sub</span><span class=p>(</span><span class=n>col</span><span class=p>,</span> <span class=n>col</span><span class=p>):</span><span class=n>match</span><span class=p>(</span><span class=s1>&#39;%s&#39;</span><span class=p>)</span> <span class=kr>then</span>
        <span class=kr>return</span> <span class=kc>true</span>
    <span class=kr>else</span>
        <span class=kr>return</span> <span class=kc>false</span>
    <span class=kr>end</span>
<span class=kr>end</span>

<span class=n>_G.tab_complete</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
    <span class=kr>if</span> <span class=n>vim.fn</span><span class=p>.</span><span class=n>pumvisible</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span> <span class=kr>then</span>
        <span class=kr>return</span> <span class=n>t</span> <span class=s2>&#34;&lt;C-n&gt;&#34;</span>
    <span class=kr>elseif</span> <span class=n>check_back_space</span><span class=p>()</span> <span class=kr>then</span>
        <span class=kr>return</span> <span class=n>t</span> <span class=s2>&#34;&lt;Tab&gt;&#34;</span>
    <span class=kr>else</span>
        <span class=kr>return</span> <span class=n>t</span> <span class=s2>&#34;&lt;C-x&gt;&lt;C-o&gt;&#34;</span>
    <span class=kr>end</span>
<span class=kr>end</span>

<span class=n>_G.s_tab_complete</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
    <span class=kr>if</span> <span class=n>vim.fn</span><span class=p>.</span><span class=n>pumvisible</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span> <span class=kr>then</span>
        <span class=kr>return</span> <span class=n>t</span> <span class=s2>&#34;&lt;C-p&gt;&#34;</span>
    <span class=kr>else</span>
        <span class=kr>return</span> <span class=n>t</span> <span class=s2>&#34;&lt;C-h&gt;&#34;</span>
    <span class=kr>end</span>
<span class=kr>end</span>

<span class=n>_G.enter_key</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
    <span class=kr>if</span> <span class=n>vim.fn</span><span class=p>.</span><span class=n>pumvisible</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span> <span class=kr>then</span>
        <span class=kr>return</span> <span class=n>t</span> <span class=s2>&#34;&lt;C-y&gt;&#34;</span>
    <span class=kr>else</span>
        <span class=kr>return</span> <span class=n>t</span> <span class=s2>&#34;&lt;CR&gt;&#34;</span>
    <span class=kr>end</span>
<span class=kr>end</span>

<span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s2>&#34;i&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;tab&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;C-R&gt;=v:lua.tab_complete()&lt;CR&gt;&#34;</span> <span class=p>,{</span><span class=n>silent</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
<span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s2>&#34;i&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;s-tab&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;C-R&gt;=v:lua.s_tab_complete()&lt;CR&gt;&#34;</span> <span class=p>,{</span><span class=n>silent</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
<span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s1>&#39;i&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;enter&gt;&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;C-R&gt;=v:lua.enter_key()&lt;CR&gt;&#39;</span> <span class=p>,{</span><span class=n>silent</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=code-navigation---vim-go>Code navigation - vim-go</h2>
<p>一樣使用 vim-go 所提供的功能</p>
<ul>
<li>
<p><code>:GoDef</code> 或是 <code>gd</code> 跳轉到定義 (<code>gd</code> 映射是 vim-go 內建，不需額外設定)</p>
</li>
<li>
<p><code>[[</code> <code>]]</code> motion</p>
<ul>
<li><code>[[</code> 跳到上一個 function 宣告處</li>
<li><code>]]</code> 跳到下一個 function 宣告處</li>
</ul>
</li>
<li>
<p>使用 <code>:GoRefer</code> 或是映射 <code>gr</code> 列出 referrer 到 location list</p>
</li>
</ul>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;gr&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;Plug&gt;(go-referrers)&#39;</span><span class=p>)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=background-compile---vim-go>Background compile - vim-go</h2>
<p>vim-go 提供了編譯和執行的功能</p>
<ul>
<li>
<p><code>:GoRun</code> 跑起 main package</p>
</li>
<li>
<p><code>:GoBuild</code> 編譯</p>
</li>
<li>
<p>如果專案使用 Makefile，可以使用 vim-dispatch 參考我<a href=https://amikai.github.io/2020/09/10/vim-make/>另一篇文章</a></p>
</li>
</ul>
<h2 id=code-format---vim-go>Code format - vim-go</h2>
<ul>
<li>
<p><code>:GoFmt</code> 排版程式碼</p>
</li>
<li>
<p>不想手動可以在每次儲存時自動排版
<code>vim.g.go_fmt_autosave = 1</code></p>
</li>
</ul>
<h2 id=async-linter---使用-nvim-lspconfig>Async linter - 使用 nvim-lspconfig</h2>
<p><img src=diagnostic.png alt=diagnostic></p>
<p>安裝 nvim-lspconfig 並且設定 gopls</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>use</span> <span class=p>{</span>
    <span class=s1>&#39;neovim/nvim-lspconfig&#39;</span><span class=p>,</span>
     <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
		<span class=n>require</span><span class=p>(</span><span class=s1>&#39;lspconfig&#39;</span><span class=p>).</span><span class=n>gopls.setup</span><span class=p>{}</span>
  		<span class=c1>-- Read the following lspconfig section and add what you need</span>
     <span class=kr>end</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>將 diagnostic 資訊顯示在程式碼旁</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>diagnostic_config</span> <span class=o>=</span> <span class=p>{</span>
    <span class=c1>-- Enable underline, use default values</span>
    <span class=n>underline</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span>
    <span class=c1>-- Enable virtual text, override spacing to 2</span>
    <span class=n>virtual_text</span> <span class=o>=</span> <span class=p>{</span>
        <span class=n>spacing</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span>
        <span class=n>prefix</span> <span class=o>=</span> <span class=s1>&#39;&lt;&#39;</span><span class=p>,</span>
    <span class=p>},</span>
    <span class=c1>-- Use a function to dynamically turn signs off</span>
    <span class=c1>-- and on, using buffer local variables</span>
    <span class=n>signs</span> <span class=o>=</span> <span class=kr>function</span><span class=p>(</span><span class=n>bufnr</span><span class=p>,</span> <span class=n>client_id</span><span class=p>)</span>
        <span class=kd>local</span> <span class=n>ok</span><span class=p>,</span> <span class=n>result</span> <span class=o>=</span> <span class=n>pcall</span><span class=p>(</span><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_buf_get_var</span><span class=p>,</span> <span class=n>bufnr</span><span class=p>,</span> <span class=s1>&#39;show_signs&#39;</span><span class=p>)</span>
        <span class=c1>-- No buffer local variable set, so just enable by default</span>
        <span class=kr>if</span> <span class=ow>not</span> <span class=n>ok</span> <span class=kr>then</span>
            <span class=kr>return</span> <span class=kc>true</span>
        <span class=kr>end</span>

        <span class=kr>return</span> <span class=n>result</span>
    <span class=kr>end</span><span class=p>,</span>
    <span class=c1>-- Disable a feature</span>
    <span class=n>update_in_insert</span> <span class=o>=</span> <span class=kc>false</span><span class=p>,</span>
<span class=p>}</span>

<span class=n>vim.lsp</span><span class=p>.</span><span class=n>handlers</span><span class=p>[</span><span class=s2>&#34;textDocument/publishDiagnostics&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>vim.lsp</span><span class=p>.</span><span class=n>with</span><span class=p>(</span>
    <span class=n>vim.lsp</span><span class=p>.</span><span class=n>diagnostic.on_publish_diagnostics</span><span class=p>,</span> <span class=n>diagnostic_config</span><span class=p>)</span><span class=err>```</span>
        <span class=o>-</span> <span class=err>在</span> <span class=n>diagnostic</span> <span class=err>之間跳轉</span>
            <span class=o>-</span> <span class=err>映射</span> <span class=err>`</span><span class=p>[</span><span class=n>d</span><span class=err>`</span> <span class=err>`</span><span class=p>]</span><span class=n>d</span><span class=err>`</span> <span class=err>跳轉到上一個和下一個</span> <span class=n>diagnostic</span>
            <span class=o>-</span> <span class=err>```</span><span class=n>plain</span> <span class=n>text</span>
<span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;[d&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;cmd&gt;lua vim.lsp.diagnostic.goto_prev()&lt;CR&gt;&#39;</span><span class=p>,{</span><span class=n>silent</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
<span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;]d&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;cmd&gt;lua vim.lsp.diagnostic.goto_next()&lt;CR&gt;&#39;</span><span class=p>,{</span><span class=n>silent</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
</code></pre></td></tr></table>
</div>
</div><p>效果如下</p>
<h2 id=code-outline---tagbar>Code outline - tagbar</h2>
<p><img src=tagbar.png alt=tagbar></p>
<p>安裝 gotags:
<code>go get -u github.com/jstemmer/gotags</code></p>
<p>直接照 gotags 文件的設定</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>use</span> <span class=p>{</span>
    <span class=s1>&#39;preservim/tagbar&#39;</span><span class=p>,</span>
    <span class=n>cmd</span> <span class=o>=</span> <span class=s1>&#39;TagbarToggle&#39;</span><span class=p>,</span>
    <span class=n>setup</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
    	<span class=c1>-- Read the following tagbar section and add what you need</span>
    <span class=kr>end</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>直接照 gotags 文件的設定</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>vim.g</span><span class=p>.</span><span class=n>tagbar_type_go</span> <span class=o>=</span> <span class=p>{</span>
    <span class=n>ctagstype</span> <span class=o>=</span> <span class=s1>&#39;go&#39;</span><span class=p>,</span>
    <span class=n>kinds</span> <span class=o>=</span> <span class=p>{</span>
        <span class=s1>&#39;p:package&#39;</span><span class=p>,</span>
        <span class=s1>&#39;i:imports:1&#39;</span><span class=p>,</span>
        <span class=s1>&#39;c:constants&#39;</span><span class=p>,</span>
        <span class=s1>&#39;v:variables&#39;</span><span class=p>,</span>
        <span class=s1>&#39;t:types&#39;</span><span class=p>,</span>
        <span class=s1>&#39;n:interfaces&#39;</span><span class=p>,</span>
        <span class=s1>&#39;w:fields&#39;</span><span class=p>,</span>
        <span class=s1>&#39;e:embedded&#39;</span><span class=p>,</span>
        <span class=s1>&#39;m:methods&#39;</span><span class=p>,</span>
        <span class=s1>&#39;r:constructor&#39;</span><span class=p>,</span>
        <span class=s1>&#39;f:functions&#39;</span>
    <span class=p>},</span>
    <span class=n>sro</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=p>,</span>
    <span class=n>kind2scope</span> <span class=o>=</span> <span class=p>{</span>
        <span class=n>t</span> <span class=o>=</span> <span class=s1>&#39;ctype&#39;</span><span class=p>,</span>
        <span class=n>n</span> <span class=o>=</span> <span class=s1>&#39;ntype&#39;</span><span class=p>,</span>
    <span class=p>},</span>
    <span class=n>scope2kind</span> <span class=o>=</span> <span class=p>{</span>
        <span class=n>ctype</span> <span class=o>=</span> <span class=s1>&#39;t&#39;</span><span class=p>,</span>
        <span class=n>ntype</span> <span class=o>=</span> <span class=s1>&#39;n&#39;</span>
    <span class=p>},</span>
    <span class=n>ctagsbin</span>  <span class=o>=</span> <span class=s1>&#39;gotags&#39;</span><span class=p>,</span>
    <span class=n>ctagsargs</span> <span class=o>=</span> <span class=s1>&#39;-sort -silent&#39;</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>映射 開啟或是關閉 tagbar</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s2>&#34;n&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;F8&gt;&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;cmd&gt;TagbarToggle&lt;cr&gt;&#34;</span> <span class=p>,{</span><span class=n>silent</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
</code></pre></td></tr></table>
</div>
</div><h2 id=fuzzy-finder---telescope>Fuzzy finder - Telescope</h2>
<p><img src=telescope.png alt=telescope></p>
<p>安裝 ripgrep，telescope 的 live_grep 和 find_files 是預設使用 ripgrep</p>
<p><code>brew install ripgrep</code></p>
<p>安裝 telescope</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>use</span> <span class=p>{</span>
    <span class=s1>&#39;nvim-telescope/telescope.nvim&#39;</span><span class=p>,</span>
    <span class=n>requires</span> <span class=o>=</span> <span class=p>{{</span><span class=s1>&#39;nvim-lua/popup.nvim&#39;</span><span class=p>},</span> <span class=p>{</span><span class=s1>&#39;nvim-lua/plenary.nvim&#39;</span><span class=p>}},</span>
    <span class=n>cmd</span> <span class=o>=</span> <span class=s1>&#39;Telescope&#39;</span><span class=p>,</span>
    <span class=n>setup</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span>
    <span class=c1>-- Read the following telescope section and add what you need</span>
    <span class=kr>end</span>
<span class=p>}</span>
</code></pre></td></tr></table>
</div>
</div><p>映射 <code>&lt;leader>fg</code> 即時文字搜索</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;leader&gt;fg&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;cmd&gt;lua require(&#39;</span><span class=n>telescope.builtin</span><span class=s1>&#39;).live_grep()&lt;cr&gt;&#39;</span><span class=p>,</span> <span class=p>{</span><span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
</code></pre></td></tr></table>
</div>
</div><p>映射 <code>&lt;leader>ff</code> 尋找 file</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=n>vim.api</span><span class=p>.</span><span class=n>nvim_set_keymap</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;leader&gt;ff&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;cmd&gt;lua require(&#39;</span><span class=n>telescope.builtin</span><span class=s1>&#39;).find_files()&lt;cr&gt;&#39;</span><span class=p>,</span> <span class=p>{</span><span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
</code></pre></td></tr></table>
</div>
</div><h1 id=結語>結語</h1>
<p>最後完成的 <a href=init.lua>init.lua</a>，貼上內容重開 neovim 後，記得使用 <code>PackerSync</code> 安裝套件</p>
<p>本篇的用意和<a href=https://amikai.github.io/2020/09/03/go_neovim_env/>上篇</a>一樣，盡量用精簡的設定檔和少量的套件打造一個短小精幹的 go 語言基礎開發環境，但使用效果和體驗和上篇效果相當，大部分的 go 語言開發功能都透用 vim-go 達成。</p>
<p>雖然我針對了了七個從 coloscheme 到 fuzzy finder 重點功能，但這其實只是個開始，你應該把這篇所寫的設定檔當成一個骨架繼續改進，甚至只要記這七個重點功能的用意，替換成你覺得更棒的，比如說你覺得 fzf 比 telescope 更棒，或是你覺得 ycm 補全比 vim-go 內建的更優秀，那就換吧，往"打造成自己最合適的開發環境"這條道路前進。</p>
<h1 id=參考來源>參考來源</h1>
<ul>
<li><a href=https://jdhao.github.io/2020/01/12/vim_nvim_history_development/>Vim 和 Neovim 的前世今生
</a></li>
<li><a href=https://blog.inkdrop.app/how-to-set-up-neovim-0-5-modern-plugins-lsp-treesitter-etc-542c3d9c9887>How to set up Neovim 0.5 + Modern plugins (LSP, Treesitter, Fuzzy finder, etc)</a></li>
<li><a href=https://github.com/fatih/vim-go/blob/master/doc/vim-go.txt><code>:help vim-go</code></a></li>
<li><a href=https://github.com/neovim/nvim-lspconfig/blob/master/doc/lspconfig.txt><code>:help nvim-lspconfig</code></a></li>
</ul>
</div>
<footer class=post-footer>
<div class=post-tags>
<a href=/tags/vim/>vim</a>
<a href=/tags/neovim/>neovim</a>
</div>
<nav class=post-nav>
<a class=next href=/2021/05/23/vim-virtualedit/>
<span class="next-text nav-default">好用的 vim virtualedit 選項</span>
<span class="next-text nav-mobile"></span>
<i class="iconfont icon-right"></i>
</a>
</nav>
</footer>
</article>
</div>
<script src=https://utteranc.es/client.js repo=amikai/my_hugo_blog_utterances issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript>
</div>
</main>
<footer id=footer class=footer>
<div class=social-links>
<a href=https://www.linkedin.com/in/yun-kai-chuang-122064a5/ class="iconfont icon-linkedin" title=linkedin></a>
<a href=https://github.com/amikai class="iconfont icon-github" title=github></a>
<a href=https://amikai.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a>
</div>
<div class=copyright>
<span class=power-by>
%!(EXTRA string=<a class=hexo-link href=https://gohugo.io>Hugo</a>)
</span>
<span class=division>|</span>
<span class=theme-info>
-
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a>
</span>
<span class=copyright-year>
&copy;
-
2021<span class=heart><i class="iconfont icon-heart"></i></span><span></span>
</span>
</div>
</footer>
<div class=back-to-top id=back-to-top>
<i class="iconfont icon-up"></i>
</div>
</div>
<script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script>
<script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script>
<script type=text/javascript src=/lib/fancybox/jquery.fancybox-3.1.20.min.js></script>
<script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-172478407-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</body>
</html>